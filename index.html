<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>èŒ¶å±‹ç”ºãªã®èŠ±çœ¼ç§‘ã€€æº€è¶³åº¦ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0; padding: 0; font-family: Arial, sans-serif;
      background: url('https://publicdomainq.net/images/201805/24s/publicdomainq-0022406tbp.jpg.pagespeed.ce.nDuw9NNEAR.jpg') no-repeat center center fixed;
      background-size: cover; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
    }
    @media (max-width: 1024px) { body { background-size: cover; background-attachment: scroll; } }
    .container { background: rgba(255,255,255,0.85); padding: 30px 20px; margin: 60px 15px; border-radius:10px; max-width:360px; width:100%; box-shadow:0 0 15px rgba(0,0,0,0.3); text-align:center; }
    .logo img { max-width:100%; height:auto; margin-bottom:20px; }
    h2 { margin-bottom:20px; }
    label { font-weight:bold; display:block; margin-bottom:5px; text-align:left; }
    select, textarea { width:100%; padding:8px; font-size:16px; margin-bottom:20px; box-sizing:border-box; }
    textarea { resize: vertical; }
    button { width:100%; padding:12px; font-size:16px; background-color:#007bff; color:white; border:none; border-radius:6px; cursor:pointer; transition:0.3s; }
    button:hover { background-color:#0056b3; }
    .reason-container { display:none; margin-bottom:20px; }
    .card { padding:30px 20px; border-radius:14px; background:#fff; box-shadow:0 4px 16px rgba(0,0,0,0.1); margin-top:20px; }
    .icon { font-size:46px; margin-bottom:8px; }
    .btn { background-color:#f5d66d; color:#444; padding:14px 22px; border-radius:8px; text-decoration:none; font-weight:bold; font-size:16px; display:inline-block; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
    .btn:hover { background-color:#f0c94d; transform:translateY(-2px);}
  </style>
</head>
<body>
  <div class="container" id="content">
    <div class="logo">
      <img src="https://www.nanohana-ganka.jp/img/logo_txt_wide.svg" alt="èŒ¶å±‹ç”ºãªã®èŠ±çœ¼ç§‘ ãƒ­ã‚´" />
    </div>
    <h2>ã”åˆ©ç”¨æº€è¶³åº¦ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</h2>
    <form id="surveyForm">
      <label for="rating">æœ¬æ—¥ã®æº€è¶³åº¦ï¼ˆ1ã€œ5ï¼‰:</label>
      <select id="rating" name="rating" required onchange="toggleReasonField()">
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="1">1ï¼ˆä¸æº€ï¼‰</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5ï¼ˆéå¸¸ã«æº€è¶³ï¼‰</option>
      </select>

      <div class="reason-container" id="reason-container">
        <label for="reason">ç†ç”±ã‚’æ•™ãˆã¦ãã ã•ã„:</label>
        <textarea id="reason" name="reason" rows="4" placeholder="ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
      </div>

      <button type="submit">é€ä¿¡</button>
    </form>
  </div>

  <script>
    const SPREADSHEET_URL = "https://docs.google.com/spreadsheets/d/1cs1n9LtLqkJCcqD9RYPQ2xaGiywonYkyC8xTd0E_BHk/edit?gid=0";

    function toggleReasonField() {
      const rating = document.getElementById('rating').value;
      const reasonContainer = document.getElementById('reason-container');
      reasonContainer.style.display = (rating === "1" || rating === "2" || rating === "3") ? "block" : "none";
    }

    const form = document.getElementById('surveyForm');
    form.addEventListener('submit', function(e){
      e.preventDefault();
      const formData = new FormData(form);
      const params = new URLSearchParams();
      for (const pair of formData.entries()) { params.append(pair[0], pair[1]); }

      // Apps Script Webã‚¢ãƒ—ãƒªã«POST
      fetch("https://script.google.com/macros/s/AKfycbySa55Psm6qobM33yd7nojGsd15vnz-ME7Rdky0XF0U2QuAHPYZnYclHWmrp72vV5yqmw/exec", {
        method: "POST", body: params
      })
      .then(() => { showResultPage(formData.get('rating')); })
      .catch(err => { alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"); console.error(err); });
    });

    function showResultPage(rating) {
      const content = document.getElementById('content');
      const ratingNum = Number(rating);

      if (ratingNum >= 4) {
        // â˜…4ä»¥ä¸Š â†’ å£ã‚³ãƒŸèª˜å°
        content.innerHTML = `
          <div class="card">
            <div class="icon">ğŸŒ¼</div>
            <h2>ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</h2>
            <p>ã‚ˆã‚ã—ã‘ã‚Œã°ã€ã‚ãªãŸã®ã”æ„è¦‹ã‚’<br><b>Googleã‚¯ãƒã‚³ãƒŸ</b>ã§ãŠèã‹ã›ãã ã•ã„ã€‚</p>
            <a href="#" class="btn" id="reviewBtn">Googleãƒãƒƒãƒ—ã§å£ã‚³ãƒŸã‚’æ›¸ã</a>
          </div>
        `;
        document.getElementById('reviewBtn').addEventListener('click', function(){
          const ua = navigator.userAgent.toLowerCase();
          if (ua.includes('android')) { window.location.href = 'https://maps.app.goo.gl/woQxRVgHVLnzZuyA6'; }
          else if (ua.includes('iphone') || ua.includes('ipad') || ua.includes('ipod')) {
            const scheme = 'comgooglemaps://?q=èŒ¶å±‹ç”ºãªã®èŠ±çœ¼ç§‘';
            const fallback = 'https://www.google.com/maps/search/?api=1&query=èŒ¶å±‹ç”ºãªã®èŠ±çœ¼ç§‘';
            const start = Date.now();
            window.location.href = scheme;
            setTimeout(()=>{ if(Date.now()-start<2000) window.location.href=fallback; },1500);
          } else { window.location.href = 'https://www.google.com/maps/search/?api=1&query=èŒ¶å±‹ç”ºãªã®èŠ±çœ¼ç§‘'; }
        });
      } else {
        // â˜…3ä»¥ä¸‹ â†’ é€šå¸¸ãŠç¤¼
        content.innerHTML = `
          <div class="card">
            <h2>ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</h2>
            <p>ä»Šå¾Œã¨ã‚‚èŒ¶å±‹ç”ºãªã®èŠ±çœ¼ç§‘ã‚’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
